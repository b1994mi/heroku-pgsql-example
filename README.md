## Intro

This is a simple app using node, express, pg, and sequelizer that I have successfully deployed to heroku and the db connection working.

## Reminder

- Make sure that `.gitignore` is present and inside it contains:
```
/node_modules
npm-debug.log
.DS_Store
/*.env
.gitignore
```

- Make sure that `package.json` on your root project folder have `"start": "node index.js"` on the `"scripts"` property, otherwise Heroku will not start the app.
```
{
  ...
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node index.js"
  },
  ...
}
```

- Make sure you have PostgreSQL added on the add-on list before pushing your app to Heroku.

- Last but not least, make sure your app listens to the correct port in the index.js file:
```
const port = process.env.PORT || 8000
app.listen(port, () => {
    console.log(`Example app listening at http://localhost:${port}`)
})
```

## Tutorials that I followed

1. [Express Sequelize Heroku Postgres Configuration Success](https://theptrk.com/2018/10/10/express-sequelize-heroku-configuration-success/)

Following this article, you will need to change the `config.json` file generated by `sequelize-cli init` so that it looks like this:
```
{
  "production": {
    "use_env_variable": "DATABASE_URL"
    , "dialect": "postgres"
    , "dialectOptions": {
      "ssl": true
    }
  }
}
```

To make sure that the db has synced, run `heroku psql` and inside that psql run `\dt` to list all the tables. But, after running `heroku logs --tail`, I soon found out that the app won't run and had to follow article No. 2.

2. ['Self signed certificate' error during query the Heroku hosted Postgres database from the Node.js application](https://stackoverflow.com/questions/61097695/self-signed-certificate-error-during-query-the-heroku-hosted-postgres-database)

After following article No. 1, I had an `Error: self signed certificate`. It turns out that I need to set the `ssl: { rejectUnauthorized: false }` on config.json. So, I need to change the `config.json` file again into:
```
{
    ...
    , "dialectOptions": {
      "ssl": { "rejectUnauthorized": false }
    }
    ...
}
```

3. [Is it safe to set rejectUnauthorized to false when using Heroku's Postgres database?](https://security.stackexchange.com/questions/229282/is-it-safe-to-set-rejectunauthorized-to-false-when-using-herokus-postgres-datab)

Just to make sure what `rejectUnauthorized: false` is, I searched it and found out that Heroku does not support client-side certificate validation to its Postgres.

## Deployed Version
I have deployed it [here](https://fierce-bastion-46830.herokuapp.com/) per 28 Jan 2021. GET method will return all the contents of table employees and POST method with body JSON as such: `{"name": "Someone"}` is enough to add a new row.
